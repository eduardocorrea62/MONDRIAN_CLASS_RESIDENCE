name: Notificar Telegram

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  send_message:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar mensagens de boas-vindas para m√∫ltiplos usu√°rios
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        run: |
          set -e  # Para parar o workflow se qualquer comando falhar

          MESSAGE="üëã SUPORTE T√âCNICO: Amanh√£ haver√° manuten√ß√£o do sistema."
          
          # IDs dos usu√°rios
          CHAT_IDS=("207223980")  # <-- Substituir pelos IDs reais
          
          for CHAT_ID in "${CHAT_IDS[@]}"; do
            echo "Enviando mensagem para o chat_id $CHAT_ID"
            RESPONSE=$(curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage" \
              -d chat_id="$CHAT_ID" \
              -d text="$MESSAGE")

            echo "Resposta da API: $RESPONSE"

            if echo "$RESPONSE" | grep -q '"ok":true'; then
              echo "Mensagem enviada com sucesso para $CHAT_ID"
            else
              echo "Erro ao enviar mensagem para $CHAT_ID"
              exit 1
            fi
          done

